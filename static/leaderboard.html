<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/css/base.css">
  <style>
    .leaderboard-tile {
      transition: transform 0.2s ease-in-out;
    }
    .leaderboard-tile:hover {
      transform: scale(1.03);
    }
    .rank-badge {
      background: #facc15; /* yellow-400 */
      color: black;
      font-weight: bold;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.9rem;
    }
    .category-title {
      @apply text-2xl font-bold text-brand-blue mt-8 mb-4;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans overflow-y-auto">
<div id="app" class="p-4">

  <!-- Header -->
  <header class="bg-brand-blue text-white flex items-center justify-between px-6 py-3 shadow-md mb-4">
    <h1 class="text-2xl font-bold">Leaderboard</h1>
    <a href="/" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded">Back</a>
  </header>

  <div v-if="loading" class="text-center text-gray-600 py-8">Loading leaderboard...</div>
  <div v-else>
    <div v-for="(entries, category) in groupedLeaderboard" :key="category">
      <h2 class="category-title">{{ category }}</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <div v-for="entry in entries" :key="entry.uid + entry.rank" class="leaderboard-tile bg-white rounded-lg shadow hover:shadow-lg p-4 flex flex-col items-center">
          <img :src="entry.image_path || '/static/images/boats/default.jpg'" alt="Boat Image" class="w-full h-40 object-cover rounded-md mb-2">
          <div class="rank-badge mb-2">{{ entry.rank }}</div>
          <h2 class="text-xl font-semibold mb-1">{{ entry.boat }}</h2>
          <p v-if="entry.angler" class="text-brand-gold font-medium mb-1">{{ entry.angler }}</p>
          <p class="text-gray-600 mb-1">{{ entry.type || 'Unknown Type' }}</p>
          <p class="text-brand-gold font-bold text-lg">{{ entry.points }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const app = Vue.createApp({
  data() {
    return {
      leaderboard: [],
      loading: true
    };
  },
  computed: {
    groupedLeaderboard() {
      const grouped = {};
      this.leaderboard.forEach(entry => {
        const category = entry.category || 'Uncategorized';
        if (!grouped[category]) grouped[category] = [];
        grouped[category].push(entry);
      });
      return grouped;
    }
  },
  mounted() {
    this.fetchLeaderboard();
  },
  methods: {
    async fetchLeaderboard() {
      try {
        const res = await fetch('/api/leaderboard');
        const data = await res.json();
        this.leaderboard = data.leaderboard || [];
      } catch (err) {
        console.error('Failed to fetch leaderboard:', err);
      } finally {
        this.loading = false;
      }
    }
  }
});

app.mount('#app');
</script>

</body>
</html>