<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Release Summary</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/css/base.css">
</head>
<body class="bg-gray-100 text-gray-900 font-sans">

<div id="app">
  <!-- Header -->
  <header class="bg-brand-blue text-white px-4 py-3 shadow-md flex justify-between items-center relative">
    <div class="flex items-center gap-4">
      <img v-if="tournamentLogo" :src="tournamentLogo" alt="Tournament Logo" class="h-14 drop-shadow">
      <span v-else class="text-white text-base">Loading Logo...</span>
    </div>
    <div class="flex gap-4 flex-wrap">
      <a href="/" class="px-3 py-2 text-white font-semibold border border-white rounded hover:bg-white hover:text-blue-900 transition">Events Feed</a>
      <a href="/participants" class="px-3 py-2 text-white font-semibold border border-white rounded hover:bg-white hover:text-blue-900 transition">Participants</a>
      <a href="/leaderboard" class="px-3 py-2 text-white font-semibold border border-white rounded hover:bg-white hover:text-blue-900 transition">Leaderboard</a>
      <a href="/release-summary" class="px-3 py-2 text-white font-semibold border border-white rounded bg-white text-blue-900 cursor-default">Release Summary</a>
      <a href="/settings-page" class="w-12 h-12 flex items-center justify-center text-white text-xl border border-white rounded hover:bg-white hover:text-blue-900 transition">⚙</a>
    </div>

    <!-- Version -->
    <div class="absolute bottom-1 left-3 text-xs text-white opacity-70" v-if="version">
      v{{ version }}
    </div>
  </header>

  <!-- Demo Banner -->
  <div v-if="demoMode" class="bg-yellow-400 text-black font-semibold p-2 text-center">
    DEMO MODE — Data is simulated from a previous tournament
  </div>

  <!-- Summary Table -->
  <div class="p-6 max-w-4xl mx-auto w-full">
    <h1 class="text-2xl font-bold text-brand-blue mb-4">Release Summary</h1>
    <div v-if="loading" class="text-gray-500 italic">Loading release summary...</div>
    <table v-else class="w-full border border-gray-300 bg-white rounded shadow-md overflow-hidden">
      <thead class="bg-brand-blue text-white">
        <tr>
          <th class="p-2">Date</th>
          <th class="p-2">Blue Marlin</th>
          <th class="p-2">White Marlin</th>
          <th class="p-2">Sailfish</th>
          <th class="p-2">Total Releases</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="day in summary" :key="day.date" class="border-b hover:bg-gray-50">
          <td class="p-2 font-semibold">{{ formatDate(day.date) }}</td>
          <td class="p-2 text-center">{{ day.blue_marlins }}</td>
          <td class="p-2 text-center">{{ day.white_marlins }}</td>
          <td class="p-2 text-center">{{ day.sailfish }}</td>
          <td class="p-2 text-center font-bold">{{ day.total_releases }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      summary: [],
      loading: true,
      tournamentLogo: '',
      version: '',
      demoMode: false
    };
  },
  mounted() {
    this.fetchSummary();
    this.fetchVersion();
    this.loadTournamentLogo();
  },
  methods: {
    fetchSummary() {
      fetch('/release-summary')
        .then(res => res.json())
        .then(data => {
          this.summary = data.summary || [];
          this.demoMode = data.demo_mode || false;
          this.loading = false;
        })
        .catch(err => {
          console.error('❌ Failed to load release summary:', err);
          this.loading = false;
        });
    },
    fetchVersion() {
      fetch('/api/version')
        .then(res => res.json())
        .then(data => {
          this.version = data.version;
        });
    },
    loadTournamentLogo() {
      fetch('/api/settings')
        .then(res => res.json())
        .then(settings => {
          const tournament = settings.tournament;
          return fetch('https://js9467.github.io/Brtourney/settings.json')
            .then(res => res.json())
            .then(all => {
              this.tournamentLogo = all[tournament]?.logo || '';
            });
        });
    },
    formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }
  }
}).mount('#app');
</script>

</body>
</html>
